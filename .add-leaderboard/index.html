<!doctype html>
<html>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100;400&display=swap" rel="stylesheet" />

<head>
  <meta charset="UTF-8" />
  <title>Leaderboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.3/dist/echarts.min.js"></script>

  <link rel="icon" type="image/png" href="assets/add.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" />

  <link href="https://cdn.jsdelivr.net/npm/prismjs@v1.x/themes/prism.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/prismjs@v1.x/components/prism-core.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/prismjs-bibtex@2.1.0/prism-bibtex.min.js"></script>


  <style>
    body {
      font-family: "JetBrains Mono", monospace;
      background-color: #ffffff;
      color: #000000;
    }

    #content {
      width: 75%;
    }

    th,
    td {
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    #notes {
      font-size: 1em;
    }

    #notes h3 {
      margin-top: 1em;
      font-size: 2em;
      text-align: center;
    }

    #notes li {
      font-size: 1.2em;
      font-weight: 300;
      margin: 1em;
    }

    .form-select {
      font-size: 1em;
    }

    @media screen and (max-width: 1400px) {
      body {
        font-size: 1.6vw;
      }

      #content {
        width: 100%;
      }

      h1 {
        font-size: 2em;
      }

      h2 {
        font-size: 1.6em;
      }

      h3 {
        font-size: 1.2em;
      }

      table {
        font-size: small;
      }
    }
  </style>
</head>

<body>
	<div class="d-flex">
		<div id="sidebar" class="p-3 bg-light" style="width: 200px;">
			<h5>Task</h5>
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" value="classification" id="task-classification">
			  <label class="form-check-label" for="task-classification">Classification</label>
			</div>
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" value="detection" id="task-detection" checked>
			  <label class="form-check-label" for="task-detection">Detection</label>
			</div>
			<div class="form-check">
			  <input class="form-check-input" type="checkbox" value="segmentation" id="task-segmentation">
			  <label class="form-check-label" for="task-segmentation">Segmentation</label>
			</div>
			
		<h5 class="mt-4">Dataset</h5>
		  <div class="form-check">
			<input class="form-check-input" type="checkbox" value="coco" id="coco" checked>
			<label class="form-check-label" for="coco">COCO</label>
		  </div>
		  <div class="form-check">
			<input class="form-check-input" type="checkbox" value="custom" id="custom">
			<label class="form-check-label" for="custom">Custom</label>
		  </div>

		<h5 class="mt-4">mAP_Size</h5>
		  <div class="form-check">
		<input class="form-check-input" type="checkbox" value="mAP_L" id="metric-l">
		<label class="form-check-label" for="metric-l">mAP_L</label>
		</div>
		<div class="form-check">
		<input class="form-check-input" type="checkbox" value="mAP_M" id="metric-m">
		<label class="form-check-label" for="metric-m">mAP_M</label>
		</div>
		<div class="form-check">
		<input class="form-check-input" type="checkbox" value="mAP_S" id="metric-s">
		<label class="form-check-label" for="metric-s">mAP_S</label>
		</div>

		<h5 class="mt-4">AP_Class</h5>
		<div class="form-check">
		<input class="form-check-input" type="checkbox" value="mAP_Tank" id="class-tank">
		<label class="form-check-label" for="class-tank">AP_Tank</label>
		</div>
		<div class="form-check">
		<input class="form-check-input" type="checkbox" value="mAP_Airplane" id="class-airplane">
		<label class="form-check-label" for="class-airplane">AP_Airplane</label>
		</div>
		<div class="form-check">
		<input class="form-check-input" type="checkbox" value="mAP_Ship" id="class-ship">
		<label class="form-check-label" for="class-ship">AP_Ship</label>
		</div>

		</div>
		<div id="content" class="container-fluid p-4">
    <h1 class="text-nowrap mt-5">üìä ADD AI Models Leaderboard</h1>
    <h3 class="fw-light text-nowrap">
      <small id="warning">ADDEval evaluates AI models developed in ADD on a variety of datasets.<br /></small>
    </h3>
    <div class="d-flex flex-row justify-content-center gap-3">
      <a href="https://add.re.kr/eps"><img
          src="assets/add-badge.png"
          alt="add" class="img-fluid"
	  style="height: 25px;"/></a>
    </div>
    <div id="chart" style="width: 100%; height: 600px"></div>
    <div class="container-fluid d-flex flex-row flex-nowrap">
      <div class="container-fluid d-flex flex-column align-items-center">
        <label for="plused" class="text-success mb-3">üìà Detection Accuracy (mAP@50:95)</label>
        <table id="plused"
          class="table table-responsive table-striped table-bordered flex-shrink-1 border border-success border-3">
        </table>
      </div>
      <div class="container-fluid d-flex flex-column align-items-center">
        <label for="origin" class="text-danger mb-3">‚ö° Inference Speed (FPS)</label>
        <table id="origin"
          class="table table-responsive table-striped table-bordered flex-shrink-1 border border-danger border-3">
        </table>
      </div>
    </div>
    <div id="notes">
      <h3>üìù Notes</h3>
      <div class="inline-block mt-3">
        <ol>
          <li>
		  Models are evaluated on the COCO dataset using standard object detection metrics:<strong>mAP@50</strong> and <strong>mAP@50:95</strong>.
          </li>
          <li>
		  FPS (Frames Per Second) is measured on a single NVIDIA A100 GPU using batch size 1.
          </li>
          <li>
		  mAP scores reflect model accuracy, while FPS reflects inference speed.
          </li>
          <li>
		  <strong>"Size"</strong> refers to the model's weight file size in megabytes (MB), as used during inference.
          </li>
          <li>
		  For fairness, all models are evaluated with their default inference resolution and no additional post-processing.
          </li>
          <li>
		  Models with üîó links redirect to their official GitHub or Hugging Face pages.
          </li>
        </ol>
      </div>
    </div>
  </div>

	<script>

	function getSelectedDatasetKey() {
	const coco = document.getElementById("coco").checked;
	const custom = document.getElementById("custom").checked;

	if (coco && custom) return "cococustom";
	else if (coco) return "coco";
	else if (custom) return "custom";
	else return null;  // Îëò Îã§ Ï≤¥ÌÅ¨ Ïïà ÌñàÏùÑ Í≤ΩÏö∞
	}

	function filterDataByDataset(data, datasetKey) {
	if (!datasetKey) return []; // ÏïÑÎ¨¥Í≤ÉÎèÑ Ïïà Ï≤¥ÌÅ¨ Ïãú
	return data.filter(row => row["dataset"] === datasetKey);
	}

	function isDetectionTaskSelected() {
	return document.getElementById("task-detection").checked;
	}

	  const originTable = document.getElementById("origin");
	  const plusedTable = document.getElementById("plused");
	  const chartDom = document.getElementById("chart");
	  var chart = echarts.init(chartDom);

	  const dataUrl = "results.json";

	  var xhr = new XMLHttpRequest();
	  xhr.open("GET", dataUrl, false);
	  xhr.send();

	  var data;
	  if (xhr.status === 200) {
		data = JSON.parse(xhr.responseText);
		data = Object.keys(data).map((key) => {
		  return {
			Model: key,
			...data[key],
		  };
		});
	  } else {
		alert("Failed to load data from results.json");
	  }
	  const globalData = data;

	  const clearTable = () => {
		originTable.innerHTML = "";
		plusedTable.innerHTML = "";
	  };

	  const clearChart = () => {
		chartOption.xAxis.data = [];
		chartOption.series[0].data = [];
		chartOption.series[1].data = [];
		chartOption.series[0].markLine.data = [];
		chartOption.series[1].markLine.data = [];
	  };

	  var chartOption = {
		legend: {
		  data: ["base"],
		  itemStyle: { opacity: 1.0 },
		},
		grid: {
		  left: "1%",
		  right: "4%",
		  bottom: "3%",
		  containLabel: true,
		},
		xAxis: {
		  name: "Model Size (MB)",
		  type: "category",
		  boundaryGap: false,
		  data: [],
		  axisLabel: {
			formatter: function (value) {
			  return value + "MB";
			},
		  },
		},
		yAxis: {
		  name: "Accuracy (%)",
		  type: "value",
		  show: true,
		  nameTextStyle: { align: "left" },
		  splitLine: { show: true, lineStyle: { type: "dashed" } },
		},
		tooltip: {
		  trigger: "item",
		  axisPointer: { type: "cross" },
		},
		series: [
		  {
			name: "base",
			type: "scatter",
			data: [],
			itemStyle: { color: "#91cc75", opacity: 0.2 },
			emphasis: { focus: "series" },
			markLine: {
			  symbol: "none",
			  emphasis: {
				label: {
				  position: "middle",
				  formatter: (params) => params.data.name,
				},
			  },
			  data: [],
			},
		  },
		  {
			name: "instructed",
			type: "scatter",
			data: [],
			itemStyle: { color: "#5470c6", opacity: 0.2 },
			emphasis: { focus: "series" },
			markLine: {
			  symbol: "none",
			  emphasis: {
				label: {
				  position: "middle",
				  formatter: (params) => params.data.name,
				},
			  },
			  data: [],
			},
		  },
		],
	  };

	  const displayTable = (table, score, data) => {
		const readableNameMap = {
			"mAP@50": "mAP@50 (%)",
			"mAP@50:95": "mAP@50:95 (%)",
			"FPS": "FPS",
		};
		const theaders = ["Model", readableNameMap[score] || score];

		const filtered = data
			.filter((row) => row["metrics"][score] != null)
			.sort((a, b) => b["metrics"][score] - a["metrics"][score]);

		const thead = document.createElement("thead");
		const headerRow = document.createElement("tr");

		const thRank = document.createElement("th");
		thRank.textContent = "#";
		headerRow.appendChild(thRank);

		theaders.forEach((header) => {
		  const th = document.createElement("th");
		  th.textContent = header;
		  headerRow.appendChild(th);
		});
		thead.appendChild(headerRow);
		table.appendChild(thead);

		const tbody = document.createElement("tbody");
		let rank = 1;

		data.forEach((row) => {
		  const dataRow = document.createElement("tr");
		  const rankCell = document.createElement("td");
		  rankCell.textContent = rank;
		  dataRow.appendChild(rankCell);

		  const modelCell = document.createElement("td");
		  modelCell.textContent =
			rank === 1 ? "ü•á " : rank === 2 ? "ü•à " : rank === 3 ? "ü•â " : "";
		  rank++;

		  const modelLink = document.createElement("a");
		  modelLink.href = row["link"];
		  modelLink.textContent = row["Model"];
		  modelLink.classList.add("link-underline-primary", "text-nowrap");
		  modelCell.appendChild(modelLink);
		  modelCell.classList.add("d-flex", "flex-nowrap");

		  dataRow.appendChild(modelCell);

		  const metricCell = document.createElement("td");
		  metricCell.textContent = row["metrics"][score];
		  metricCell.classList.add(score === "FPS" ? "text-danger" : "text-success");
		  dataRow.appendChild(metricCell);

		  tbody.appendChild(dataRow);
		});

		table.appendChild(tbody);
	  };

	  const displayChart = (score, data) => {
		const maxMarkLineModels = 8;

		const filtered = data
			.filter((model) => model["metrics"] && model["metrics"][score] != null)
			.sort((a, b) => b["metrics"][score] - a["metrics"][score]);

		const sizeList = [...new Set(filtered.filter(m => m.size != null).map(m => Math.round(m.size)))].sort((a, b) => a - b);

		chartOption.xAxis.data = sizeList;
		chartOption.yAxis.max = 1 + Math.max(...filtered.map((model) => model["metrics"][score]));

		const sizedModels = filtered.filter((model) => model["size"] != null);
		const nonSizeModels = filtered.filter((model) => model["size"] == null).slice(0, maxMarkLineModels);

		chartOption.series[0].data = [];
		chartOption.series[0].markLine.data = [];

		sizedModels.forEach((model) => {
		  chartOption.series[0].data.push({
			name: model["Model"],
			value: [`${Math.round(model["size"])}`, model["metrics"][score]],
		  });
		});

		const offsets = [[50, 0], ...Array(sizeList.length - 2).fill([0, 0]), [-50, 0]];

		sizeList.forEach((size, idx) => {
		  const bestModel = sizedModels
			.filter((m) => Math.round(m["size"]) === size)
			.sort((a, b) => b["metrics"][score] - a["metrics"][score])[0];
		  if (bestModel) {
			const point = chartOption.series[0].data.find((p) => p.name === bestModel["Model"]);
			point.itemStyle = { opacity: 1.0 };
			point.label = {
			  show: true,
			  position: "top",
			  offset: offsets[idx],
			  formatter: (params) => params.data.name,
			  color: "inherit",
			};
		  }
		});

		chart.setOption(chartOption);
	  };

	  function updateView() {
		if (!isDetectionTaskSelected()) {
			clearTable();
			clearChart();
			document.getElementById("warning").innerText = "Select 'Detection' task to view leaderboard.";
			return;
		}

		const selectedKey = getSelectedDatasetKey();
		const filteredData = filterDataByDataset(globalData, selectedKey);

		clearTable();
		clearChart();
		displayTable(plusedTable, "mAP@50:95", filteredData);
		displayTable(originTable, "FPS", filteredData);
		displayChart("mAP@50:95", filteredData);

		document.getElementById("warning").innerText =
			"ADDEval evaluates AI models developed in ADD on a variety of datasets.";
		}

			document.getElementById("coco").addEventListener("change", updateView);
			document.getElementById("custom").addEventListener("change", updateView);
			document.getElementById("task-detection").addEventListener("change", updateView);
			document.getElementById("task-classification").addEventListener("change", updateView);
			document.getElementById("task-segmentation").addEventListener("change", updateView);


		// Ï¥àÍ∏∞ Î°úÎî© Ïãú
		updateView();

	  window.addEventListener("resize", () => {
		chart.resize();
	  });
	</script>

</body>

</html>
